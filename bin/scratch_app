#!/usr/bin/env raku
use v6.d;
use lib 'lib';
use LLM::Client::OpenAI;
use LLM::Messages;
use JSON::Fast;

my $messages = LLM::Messages.new;

$messages.build-messages('Is it snowing in Dublin?', LLM::Messages.USER);

my Str $tools = q:to/END/;
		  "tools": [
			{
			  "type": "function",
			  "function": {
				"parameters": {
				  "required": [
					"location"
				  ],
				  "type": "object",
				  "properties": {
					"unit": {
					  "type": "string",
					  "enum": [
						"celsius",
						"fahrenheit"
					  ]
					},
					"location": {
					  "description": "The city and state, e.g. San Francisco, CA",
					  "type": "string"
					}
				  }
				},
				"name": "get_current_weather",
				"description": "Get the current weather in a given location"
			  }
			}
		  ],
		END

my $client = LLM::Client::OpenAI.new();
my %result = $client.completion-tools($messages, $tools);
say %result<choices>[0]<message><tool_calls>[0]<function><name>